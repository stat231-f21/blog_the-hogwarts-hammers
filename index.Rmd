---
title: "Suicide Rates Across the World"
author: "Victoria Kuntz and Rohil Bathija"
date: "December 8th 2021"
output:
  rmdformats::readthedown:
    thumbnails: false
    highlight: "kate"
    self_contained: false
---

```{r setup, include = FALSE}
library(tidyverse)
library(kableExtra)
library(viridis)
library(rnaturalearth)
library(rnaturalearthdata)
library(sf)
library(plotly)
library(rgeos)
library(rgdal)
library(leaflet)
library(RColorBrewer)
library(widgetframe)
library(htmltools)
library(tidyRSS)
library(wordcloud)
library(wordcloud2)
library(tm)
library(stringr)

# for example code; delete if not needed

# Set code chunk defaults
knitr::opts_chunk$set(
  echo = FALSE,
  mesage = FALSE,
  warning = FALSE,
  fig.align = "center"
)

# Set R environment options
options(knitr.kable.NA = "")
```

```{r reading-data, eval = TRUE, include = FALSE}
MHBeds <- read_csv("data/mental-health-hospital.csv", show_col_types = FALSE)
suicideRate <- read_csv("data/suicide-death-rates.csv", show_col_types = FALSE)
sexualViolence <- read_csv("data/NonPartnerSexualViolenceByCountry.csv", show_col_types = FALSE)
suicideState <- read_csv("data/StateData.csv", show_col_types = FALSE) %>%
  rename(id = "STATE")
maleFemaleRatio <- read_csv("data/Male-Female-Ratio-of-Suicide-Rates.csv")
gunData <- read_csv("data/gunOwnership.csv")
leafletData <- readOGR(
  dsn = paste0(getwd(), "/data/LeafletData"),
  layer = "TM_WORLD_BORDERS_SIMPL-0.3",
  verbose = FALSE
)
```


```{r wrangling, include = FALSE}
# Rename country codes and years and drop unnecessary columns so that all data sets match
maleFemaleRatio <- maleFemaleRatio %>%
  mutate(ISO3 = Code)
suicideRate <- suicideRate %>%
  mutate(ISO3 = Code)
MHBeds <- MHBeds %>%
  select("GHO_DISPLAY", "YEAR", "COUNTRY_CODE", "Number_Beds") %>%
  mutate(ISO3 = COUNTRY_CODE, Year = YEAR)

# Pull out different bed metrics into separate data sets
MHBedsInMHHospitals <- MHBeds %>%
  filter(GHO_DISPLAY == "Beds in mental hospitals (per 100 000 population)") %>%
  mutate(BEDS_IN_MENTAL_HOSPITALS = Number_Beds) %>%
  select(Year, ISO3, BEDS_IN_MENTAL_HOSPITALS)
MHBedsInGeneralHospitals <- MHBeds %>%
  filter(GHO_DISPLAY == "Beds for mental health in general hospitals (per 100 000 population)") %>%
  mutate(BEDS_IN_GENERAL_HOSPITALS = Number_Beds) %>%
  select(Year, ISO3, BEDS_IN_GENERAL_HOSPITALS)
MHBedsInCommunityHospitals <- MHBeds %>%
  filter(GHO_DISPLAY == "Beds in community residential facilities (per 100 000 population)") %>%
  mutate(BEDS_IN_COMMUNITY_FACILITIES = Number_Beds) %>%
  select(Year, ISO3, BEDS_IN_COMMUNITY_FACILITIES)

# Combine bed data into a single data set and replace NA with 0
bedData2016 <- full_join(MHBedsInMHHospitals, full_join(MHBedsInGeneralHospitals, MHBedsInCommunityHospitals)) %>%
  replace_na(list(BEDS_IN_MENTAL_HOSPITALS = 0, BEDS_IN_GENERAL_HOSPITALS = 0, BEDS_IN_COMMUNITY_FACILITIES = 0)) %>%
  mutate(TOTAL_BEDS = BEDS_IN_MENTAL_HOSPITALS + BEDS_IN_GENERAL_HOSPITALS + BEDS_IN_COMMUNITY_FACILITIES) %>%
  filter(Year == 2016)

# Join together all data sets into a single data set for display
suicideData <- full_join(suicideRate, maleFemaleRatio)
suicideData <- full_join(suicideData, bedData2016)
suicideData2016 <- suicideData %>%
  filter(Year == "2016")
write_csv(suicideData, "fullSuicideData.csv")
maleFemaleRatio2017 <- maleFemaleRatio %>%
  filter(Year == "2017")

leafletMaleFemaleRatio2017 <- merge(leafletData, maleFemaleRatio2017, by = "ISO3")
leafletSuicideData2016 <- merge(leafletData, suicideData2016, by = "ISO3")
```

```{r, include = FALSE}
# Get all years into one row of the data frame
wideSuicideData <- NULL
for (year in 1990:2017) {
  dataForYear <-
    suicideData %>%
    filter(Year == year) %>%
    select(ISO3, SuicideDeathRate) %>%
    drop_na()
  rateName <- paste("Rate", year, sep = "")
  dataForYear[rateName] <- dataForYear$SuicideDeathRate
  dataForYear <- dataForYear %>% select("ISO3", rateName)
  if (is.null(wideSuicideData)) {
    wideSuicideData <- dataForYear
  } else {
    wideSuicideData <- full_join(wideSuicideData, dataForYear, by = c("ISO3"))
  }
}
write_csv(wideSuicideData, "suicideRatesWideYears.csv")
```

## Motivation
 Suicide is consistently one of the leading causes of death in the world with close to one million people dying by suicide each year (Source: World Health Organization). In fact, in the US alone, suicide is the second leading cause of death for people between the ages of 10 and 34. (Source: National Institute of Health) As you can see from the plot below, the issue has only been getting worse for the last 20 years. Suicide is an incredibly complex issue with many contributing factors. 
 
Suicide is regularly in the news. We hear about the uniquely American problem of guns in assisting suicide and about the shortage of mental health beds across the world. The goal of this blog was to get some hard data and look at how the issue of suicide varies across the world. What role, if any, do guns play in suicide rate? What role, if any, does the availability of mental health beds play in suicide rate? The aim of our blog is to inform readers about suicide around the world and within the US and to explore several trends and variables contributing to suicide deaths. 
 
```{r usSuicideRates}
usSuicideRatesPost2000 <- suicideRate %>%
  filter(Code == "USA", Year >= 2000)
ggplot(usSuicideRatesPost2000, aes(x = Year, y = SuicideDeathRate)) +
  labs(
    y = "Suicide death rate per 100,000 people",
    title = "Suicide Death rates in the US through time"
  ) +
  geom_line()
```

## Data 
  In order to look into suicide across the world, we pulled together multiple data sets. The World Health organization has extensive data on mental health and suicide. These include:
  
  * Suicide rates per 100,000 people
  * Male and female suicide rates per 100,000 people
  * The number of mental health beds available per 100,000 people
  

  To examine the geographic distribution of our data, we downloaded the TM_WORLD_BORDERS_SIMPL map data from http://thematicmapping.org, and joined our data sets to the geographic data based on the ISO3 country codes in the data. We used the leaflet package to create interactive maps of our data. To produce an interactive shiny app that explored the evolution of suicide rates over time, we massaged the data to get all years of suicide data into a single row for each country so that we could efficiently move through the years without redrawing the whole map.
  
  To examine the headlines in the news, we used Google's news RSS API feed. This API allows us to search Google news and get a list of headlines matching a search term from a particular country for a particular point in time. Because the API returns a maximum of 100 rows per query, we had to break a three year period into one month periods and combine the data together.

  
## Suicide Rates Around the World
  To begin our exploration into suicide rates, we decided to plot suicide rates around the world. The map below shows a plot of suicide deaths per 100,000 people in 2016. Over each country is a circle representing its respective suicide death rate. The larger and more red the circle, the higher the suicide rate. The smaller and bluer the circle, the lower the suicide rate. You can hover your cursor above any country to see the name of the country and its suicide rate. 
  
<center><h3>Death rate from suicides, 2016</center></h3>
  
```{r, echo=FALSE}
mybins <- c(0, 1, 2, 5, 7, 10, 12, 15, 20, 25, 30, 50, 100)
myPalette <- colorBin(
  palette = c(
    "#333399",
    "#555599",
    "#777799",
    "#999999",
    "#ffcccc",
    "#ffaaaa",
    "#ff9999",
    "#ff7777",
    "#cc5555",
    "#aa0000",
    "#550000",
    "#330000"
  ),
  domain = leafletSuicideData2016,
  na.color = "transparent",
  bins = mybins
)
hoverText <-
  paste(
    "Country: ", leafletSuicideData2016@data$NAME, "<br/>",
    "Suicide Rate (2016): ", leafletSuicideData2016$SuicideDeathRate, "<br/>",
    sep = ""
  ) %>%
  lapply(htmltools::HTML)
leaflet(leafletSuicideData2016) %>%
  addTiles() %>%
  setView(lat = 30, lng = 0, zoom = 1.5) %>%
  addLegend(pal = myPalette, values = leafletSuicideData2016$SuicideDeathRate, opacity = .7, title = "Suicide Death Rate<br/>Per 100k", position = "bottomleft") %>%
  addCircles(
    lat = leafletSuicideData2016$LAT, lng = leafletSuicideData2016$LON,
    radius = leafletSuicideData2016$SuicideDeathRate * 10000,
    opacity = 1,
    fillOpacity = .7,
    weight = 1,
    group = "circles",
    color = myPalette(leafletSuicideData2016$SuicideDeathRate),
    fillColor = myPalette(leafletSuicideData2016$SuicideDeathRate),
    label = hoverText,
    labelOptions = labelOptions(
      style = list("font-weight" = "normal", padding = "3px 8px"),
      textsize = "13px",
      direction = "auto"
    )
  )
```


<br> Looking at this distribution, a number of interesting characteristics jump out. North America and Western Europe generally have suicide rates of around 10-20 deaths per 100,000 people. Suicide rates are particularly high in eastern Europe and Russia and are catastrophically high in Greenland. We can also see that there is a band all across the mid-part of the world, including the Middle East, Mediterranean Europe, Central America, and southern Asia, that has significantly lower suicide rates than the rest of the world, most of which are under 5 deaths per 100,000 people. This begs the question, why? What factors play into these suicide rates?  

#### Methodology
This map was produced by filtering the WHO suicide rate data down to just 2016, merging it with the "thematicmapping" geographic data, and creating interactive maps using the leaflet package. We found that it was much easier to see the trends in the data if we created a custom color map based on ranges of suicide rate and made both the color and size of our dots represent the suicide rate. We tried coloring the countries by suicide rate, and it was pretty, but representing suicide rates with colored circles was much more illuminating.

### Suicide rates throughout time
  Before we look at what factors influence these suicide rates, lets see whether the patterns we are seeing are true across time or just in 2016. Are there more time relevant factors that come into play? 
  In order to look into suicide rates over time, we created a Shiny app. The app includes a slider of years. You can slide the bar to whichever year you would like to explore. Clicking the play button under the slider will automate the movement of the slider consecutively through the years. The map will change accordingly. 
  
<iframe height="800" width="100%" frameborder="no" src="https://vkuntz23.shinyapps.io/WorldSuicideRates/"> </iframe>


<br> Looking at this shiny app, we can see that, for the most part, the trends we saw in the 2016 map hold. In addition, we can see a few new anomalies. Most noticeably, in 1993, right after the economic crash post the fall of the Soviet Union, the entire former Soviet Union sees a rapid increase in suicide rates across the board. In addition, looking more closely at Iraq, in 2005, suicide rates begin to quickly decrease. In 2005, the US pulled their troops out of Iraq. These events likely had an impact on the general well being of the residents of these countries and played a role in increasing and decreasing suicide rates. As you might expect, the military and economic changes in countries seem to have an impact on suicide rate. 

In general, we can see that most countries have a lower suicide rate in 2017 than in 1990. Some key exceptions include the Unites States, South Korea, and China. Greenland sees the most drastic improvement in suicide rate. 

Looking back at our previous conclusions, why does the middle of the world, that is, the Middle East, Mediterranean Europe, Central America, and southern Asia, have lower suicide rates than the rest of the world?

#### Methodology
This data in this shiny app was displayed the same way as our earlier map data. However, we had to wrangle the data so that each country had many years of data in one row so that we could smoothly display how the data was changing over time. Switching between different filtered data sets caused the map to flicker badly.

### A look at the relationship between suicide and temperature

Our first thought when trying to figure out what connected the mid-world countries was that they were generally in the center of the world and latitude might be a causing factor. In particular, number of hours of light in a day. However, if you look closely, this band of countries is actually north of the equator which wouldn't make sense if it's about hours of light in a day. If it were, we would expect this band to be straight across the equator. Our next thought was that temperature could have an affect on suicide rate. To explore this relationship, we created a scatter plot comparing the average temperature in each country to its suicide rate per 100,000 people. 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
temperatureData <- read.csv("data/Country_temperatureCRU.csv") %>%
  select(ISO_3DIGIT, Annual_temp) %>%
  rename(ISO3 = ISO_3DIGIT, TEMP = Annual_temp)
deathRateTemperatureData2016 <- left_join(suicideData2016, temperatureData)
ggplot(deathRateTemperatureData2016, aes(x = SuicideDeathRate, y = TEMP)) +
  xlim(0, 33.5) +
  labs(
    title = "How temperature impacts suicide rate",
    y = "Temperature (Celsius)",
    x = "Suicide death rate per 100,000"
  ) +
  geom_point() +
  geom_smooth(method = lm)
```

<br> From this plot, we observe a negative correlation between temperature and suicide rate which implies that higher temperatures are correlated with lower suicide rates. This is, however, a weak correlation and while it could play a role in why we see this band of lower suicide rates, it is likely just one of multiple factors.

Although we can't explore all of them, external factors clearly play an important role in affecting suicide rate. If external factors were the only thing playing into suicide rate, then there would be very little conversation about suicide. It is clear that this is not the case. Everyone has ideas on how to improve suicide rates. Can we see any trends in what the news is saying about what we need to decrease suicide rates?

## What does the United States need?
In order to get an idea of what the United States thinks is needed to improve suicide rates, we created a word cloud. This word cloud shows the most common words in articles that discuss mental health needs in the title by searching a Google news rss feed. 
```{r, message=FALSE, echo=FALSE, warning=FALSE}
getNewsWordCloud <- function(startDate, yearCount, interval, searchTerm, wordsToRemove, country) {
  allTitles <- data.frame()
  print(startDate)
  print(yearCount)
  print(interval)
  print(searchTerm)
  print(wordsToRemove)
  print(country)
  # Loop over two day periods in 2014 and 2015 to get all headlines. Google RSS feed is limited to 100
  # headlines, so we will miss articles if we go with longer time periods

  numIntervals <- as.integer(yearCount * 365 / interval)

  for (day in 1:numIntervals) {
    nextDate <- startDate + interval
    print(paste("Getting articles from", startDate, "to", nextDate))
    newsUrl <- URLencode(paste0("https://news.google.com/rss/search?q=", searchTerm, "+after:", startDate, "+before:", nextDate, "&ceid=", country, "&gl=", country))
    scrapedTitles <- tryCatch(
      # Some days have no articles. Handle the error so that the scrape doesn't crash
      error = function(cnd) {
        return(NA)
      },
      scrapedTitles <- newsUrl %>%
        tidyfeed() %>%
        select(item_title)
    )

    print(paste("Got ", nrow(scrapedTitles), "articles"))
    allTitles <- allTitles %>% rbind(scrapedTitles)
    startDate <- nextDate
  }
  # Remove names of sources
  allTitles <- allTitles %>%
    mutate(item_title = gsub(" *-[^-]*$", "", item_title)) %>%
    mutate(item_title = gsub(" *\\|.*$", "", item_title))
  processedTitles <- Corpus(VectorSource(allTitles$item_title)) %>%
    tm_map(stripWhitespace) %>%
    tm_map(removePunctuation) %>%
    tm_map(removeNumbers) %>%
    tm_map(content_transformer(tolower)) %>%
    tm_map(removeWords, stopwords("english")) %>%
    tm_map(removeWords, wordsToRemove)
  # tm_map(removeWords, c("suicide", "news", "times", "suicides"))

  termDocumentMatrix <- TermDocumentMatrix(processedTitles)
  matrix <- as.matrix(termDocumentMatrix)
  words <- sort(rowSums(matrix), decreasing = TRUE)
  wordDataframe <- data.frame(word = names(words), freq = words)
  wordDataframe
}
```


```{r, message=FALSE, warning=FALSE, echo=FALSE}
usMentalHealthNeeds = read.csv('data/USMentalHealthNeedsWords.csv')
greatBritainMentalHealthNeeds = read.csv('data/GBMentalHealthNeedsWords.csv')

```


```{r, message=FALSE, warning=FALSE, echo=FALSE}
set.seed(3000)
wordcloud(words = usMentalHealthNeeds$word, freq = usMentalHealthNeeds$freq, min.freq = 1, max.words = 100, rot.per = 0.35, colors = brewer.pal(8, "Dark2"))
```

<br> Some of the most common words seen in the word cloud above are illness, hospital, care, and treatment, all of which relate to mental health care. Based solely on the words most used in news articles relating to mental health needs, we can see that an increase in mental health care is desired. What does an increase in mental health care mean? It could mean more school programs exploring mental health, more therapists, or even more hospital beds. We chose to explore what relationship number of hospital beds had with suicide rate. The US thinks we need more hospitals, do more hospitals correlate with lower suicide rates? 

#### Methodology
To create these word clouds, we first had to get years worth of news headlines from the Google News RSS feed. In order to try lots of different variations of search terms, we created a function that allowed us to pull data from any period of time with any search terms for any country. We had to break our time periods into small time periods so that no time period had more than 100 headlines. These headlines had journal names at the end of them, so we had to remove those first so that the journal names weren't the most common words. We then created a Corpus of the headlines using the tm pacakge, and removed all whitespace, punctuation, numbers and stop words (and, the, a, ...) from the data. We used a TermDocumentMatrix to get a set of terms, and transformed that into a data frame with words and frequencies. This was what we needed to use the wordcloud package to display a word cloud.


### Does having more mental health hospital beds actually correlate with lower suicide rates?
  To explore this relationship we created another scatter plot, this time relating number of hospital beds per country in 2016 to suicide rate per 100,000 in 2016. 
```{r, warning=FALSE, message=FALSE, echo=FALSE}
deathRateNumberBeds <- left_join(suicideData2016, bedData2016)
ggplot(deathRateNumberBeds, aes(x = SuicideDeathRate, y = TOTAL_BEDS)) +
  xlim(0,30) +
  labs(title = "How number of mental health beds relates to suicide rate", y = "Total number of mental health beds", x = "Suicide rate per 100,000") +
  geom_point() +
  geom_smooth(method = lm)
```

<br> Interestingly enough, this plot shows a slight positive correlation between number of mental health hospital beds and suicide rate. This means that more hospital beds is correlated with a higher suicide rate. While this is initially surprising, it does make sense: if there are more suicidal people, there is a higher demand for hospital beds. However, if those hospital beds were really effective in preventing suicide, we would expect increased beds to lower the suicide rate.

  
## Limitations
There are a number of limiations of looking at worldwide suicide data. First, different data points are missing for different countries. Second, the quality of reporting of suicide data varies widely around the world. Third, some countries, like China and North Korea have extensive control over information and an incentive to report low rates. Suicide is also a very loaded term. Many suicides may be reported as accidental deaths, and failed suicides are also not reported. The tendency of suicide to be reported as accidental death likely varies widely around the world. In the word cloud, the data we could easily access was news headlines. These are generally attention grabbing, and not a good reflection of the actual content of the articles.

```{r leaflet, echo = FALSE}
# mybins <- c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11)
# mypalette <- colorBin(
#   palette = c("#ff0000", "#ddddff", "#bbbbff", "#9999ff", "#7777ff", "#5555ff", "#3333cc", "#1111aa", "#000099", "#000055", "#000000"),
#   domain = leafletSuicideData2016@data$MaleFemaleSuicideRatio,
#   na.color = "transparent",
#   bins = mybins
# )
# 
# # Prepare the text for tooltips:
# hoverText <- paste(
#   "Country: ", leafletSuicideData2016@data$NAME, "<br/>",
#   "Suicide Rate: ", round(leafletSuicideData2016@data$SuicideDeathRate, 2), "<br/>",
#   "Ratio of male to female suicide: ", round(leafletSuicideData2016@data$MaleFemaleSuicideRatio, 2),
#   sep = ""
# ) %>%
#   lapply(htmltools::HTML)
# 
# # Final Map
# leaflet(leafletSuicideData2016) %>%
#   addTiles() %>%
#   setView(lat = 10, lng = 0, zoom = 2) %>%
#   addPolygons(
#     fillColor = ~ mypalette(MaleFemaleSuicideRatio),
#     stroke = TRUE,
#     fillOpacity = 1,
#     color = "white",
#     weight = 1,
#     label = hoverText,
#     labelOptions = labelOptions(
#       style = list("font-weight" = "normal", padding = "3px 8px"),
#       textsize = "13px",
#       direction = "auto"
#     )
#   ) %>%
#   addLegend(pal = mypalette, values = ~MaleFemaleSuicideRatio, opacity = 1, title = "Ratio of Male to Female Suicide", position = "bottomleft")
```


```{r worldMap4, echo=FALSE}
# mybins <- c(0, 1, 2, 5, 7, 10, 12, 15, 20, 25, 30, Inf)
# mypalette <- colorBin(
#   palette = c(
#     "#333399",
#     "#555599",
#     "#777799",
#     "#999999",
#     "#ffcccc",
#     "#ffaaaa",
#     "#ff9999",
#     "#ff7777",
#     "#cc5555",
#     "#aa0000",
#     "#550000"
#   ),
#   domain = leafletSuicideData2016@data$SuicideDeathRate,
#   na.color = "transparent",
#   bins = mybins
# )
#
# # Prepare the text for tooltips:
# hoverText <- paste(
#   "Country: ", leafletSuicideData2016@data$NAME, "<br/>",
#   "Total MH Beds: ", leafletSuicideData2016@data$TOTAL_BEDS, "<br/>",
#   "Suicide Rate: ", round(leafletSuicideData2016@data$SuicideDeathRate, 2), "<br/>",
#   "Ratio of male to female suicide: ", round(leafletSuicideData2016@data$MaleFemaleSuicideRatio, 2),
#   sep = ""
# ) %>%
#   lapply(htmltools::HTML)
#
# # Final Map
# leaflet(leafletSuicideData2016) %>%
#   addTiles() %>%
#   setView(lat = 10, lng = 0, zoom = 2) %>%
#   addPolygons(
#     fillColor = ~ mypalette(SuicideDeathRate),
#     stroke = TRUE,
#     fillOpacity = 1,
#     color = "white",
#     weight = 1,
#     label = hoverText,
#     labelOptions = labelOptions(
#       style = list("font-weight" = "normal", padding = "3px 8px"),
#       textsize = "13px",
#       direction = "auto"
#     )
#   ) %>%
#   addLegend(pal = mypalette, values = ~SuicideDeathRate, opacity = 1, title = "Suicide Death Rate", position = "bottomleft")
```

```{r worldMap3, include = FALSE}
# mybins <- c(0, 1, 2, 3, 4, 5, 8, 10, 15, 20, 50, 100)
# mypaletteDeathRate <- colorBin(
#   palette = c("#ffffff", "#ddddff", "#bbbbff", "#9999ff", "#7777ff", "#5555ff", "#3333cc", "#1111aa", "#000099", "#000055", "#000000"),
#   domain = leafletSuicideData2016@data$SuicideDeathRate,
#   na.color = "transparent",
#   bins = mybins
# )
#
# mybins <- c(0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11)
#
# mypaletteMaleFemale <- colorBin(
#   palette = c("#009900", "#0000ff", "#2200dd", "#4400aa", "#660099", "#880077", "#aa0066", "#bb0055", "#cc0033", "#ee0011", "#ff0000"),
#   domain = leafletSuicideData2016@data$MaleFemaleSuicideRatio,
#   na.color = "transparent",
#   bins = mybins
# )
# # Prepare the text for tooltips:
# hoverText <- paste(
#   "Country: ", leafletSuicideData2016@data$NAME, "<br/>",
#   "Total MH Beds: ", leafletSuicideData2016@data$TOTAL_BEDS, "<br/>",
#   "Suicide Rate: ", round(leafletSuicideData2016@data$SuicideDeathRate, 2), "<br/>",
#   "Ratio of male to female suicide: ", round(leafletSuicideData2016@data$MaleFemaleSuicideRatio, 2),
#   sep = ""
# ) %>%
#   lapply(htmltools::HTML)
#
# # Final Map
# leaflet(leafletSuicideData2016) %>%
#   addTiles() %>%
#   setView(lat = 30, lng = 0, zoom = 1.6) %>%
#   addPolygons(
#     fillColor = ~ mypaletteDeathRate(SuicideDeathRate),
#     stroke = TRUE,
#     fillOpacity = 0,
#     opacity = 0,
#     color = "black",
#     weight = 1,
#     label = hoverText,
#     labelOptions = labelOptions(
#       style = list("font-weight" = "normal", padding = "3px 8px"),
#       textsize = "13px",
#       direction = "auto"
#     )
#   ) %>%
#   addCircles(lat = leafletSuicideData2016@data$LAT, lng = leafletSuicideData2016@data$LON, weight = 1, opacity = 1, fillOpacity = .7, radius = sqrt(leafletSuicideData2016@data$SuicideDeathRate) * 40000, color = "white", fillColor = mypaletteMaleFemale(leafletSuicideData2016@data$MaleFemaleSuicideRatio)) %>%
#   #  addLegend(pal = mypaletteDeathRate, values = ~SuicideDeathRate, opacity = 1, title = "Suicide Death Rate", position = "bottomleft") %>%
#   addLegend(pal = mypaletteMaleFemale, values = ~MaleFemaleSuicideRatio, opacity = .7, title = "Male Female Ratio", position = "bottomleft")
```



## A Deeper Dive into the United States
### Motivations
Now that we have explored the world, I wanted to take a deeper look at the United States and how we, as a country, handle suicide and the root causes behind it. By understanding how mental health and suicide play out in the United States, we can then identify causes and hence, help drive policy change to better the lives of all the people in the world.

### Data
For this deep dive into the United States, there were predominantly four data sources:

  1. *StateData.CSV* - Downloaded csv from the CDC. This dataset contained suicide rates and deaths by suicide for each state.
  2. *gunOwnership.csv* - Downloaded csv from the World Population review. This dataset contained data on the gun ownership percent in each state as well as the total guns in each state.
  3. *State data package* - from the base R package that helped normalize the different ways states are represented in data (abbreviations, names, upper-case, lower-case, etc.)
  4. *Map data* - from the maps package that was used to help visualize spatial data when converted into an 'sf' object

## Distribution of Suicide Rates

### Methodology

To create the plot shown in this section, I utilized the state dataset, map data, as well as StateData. the first things I had to do was to join the state info with the data in state data so that I could use that new dataset for the ultimate plotting of the map. After some wrangling, I was able to do this and then combine it with the map data and setting that dataset as a 'simple feature' object which is the standard data container for spatial data. after getting this dataset ready, it was just a matter of using ggplot and the aes functions to create a US Map that had each state colored based on the suicide rate in that state. I had also created an identical plot for total deaths by suicide but after looking at the output realized that plot did not show much other than the population density as states with higher populations naturally had higher suicide deaths than those with small populations. Lastly, I wanted to add some interactivity to the plot so that there was a hover feature that showed the exact rate in each state. To do this, I used the *plotly* package which allowed me to plot the map with *dynamicTicks* set to True which behaved the way I intended.

### Analysis

Before looking at the plot, I had no sense of where the suicide rates would be higher within the United States. Although, I had hypothesized that rates would be higher in more densely populated cities do to the fast-paced life that most people live in those areas. Therefore, when I saw the figure below, I was quite surprised to see the results.
```{r usMapParts, include=FALSE,fig.width = 8, fig.height = 4, fig.align="center"}
data(state)
#need a master dataset for state name, and abbreviations
state_info <- data.frame(
  Region = state.region,
  # Match state variable name in map data
  state = tolower(state.name),
  # Match state variable name in summary data
  id = state.abb
)
#creating one dataset where all the suicide info will be
SuicideStateWithInfo <- suicideState %>%
  #added in state name and abbreviations
  left_join(state_info, by = "id") %>%
  #only want the most recent year (one year of data)
  filter(YEAR == "2019") %>%
  select(c("YEAR", "id", "RATE", "DEATHS", "Region", "state")) %>%
  #renaming the id columns so that future joins work
  rename(region = "Region", state = "id", id = "state")
rename(state_info, id = "state", state = "id")
#this is the object needed for the geospatial representation
state_map <- maps::map("state", plot = FALSE, fill = TRUE) %>%
  st_as_sf() %>%
  #changed capitalization for joins
  rename(id = "ID")

#created the object to be plotted along with the data
graphs_map <- state_map %>%
  left_join(SuicideStateWithInfo, by = "id")

#shows the map with distribution of total deaths
#decided to comment it out and not use it because it doesn't show anything but population density

#y <- ggplot(graphs_map, aes(fill = DEATHS, text = paste("State: ", id))) +
  #geom_sf(size = .2, colour = "white") +
  #scale_fill_viridis(option = "magma", direction = -1)
#theme_void()
#ggplotly(y, dynamicTicks = TRUE)

#created plot object with us map and have labeled text for the hover feature of plotly
x <- ggplot(graphs_map, aes(fill = RATE, text = paste("State: ", id))) +
  geom_sf(size = .2, colour = "white") +
  scale_fill_viridis(option = "magma", direction = -1) +
  #adding legend title and title
  labs(fill = "Suicide Rate",
       title = "Suicide Rate (per 100,000 people) by State")
theme_void()
```
 
```{r finalUSMap, echo = FALSE, fig.width = 8, fig.height = 4, fig.align="center"}
# plotting the plot object dynamically
ggplotly(x, dynamicTicks = TRUE)
```
As you can see above, the states with the highest suicide rates are Wyoming and Montana. Going further, it seems that the cluster around the center of the map (northwest of Texas) have the highest suicide rates by a significant margin. In contrast, the more populated areas of the USA actually have the lowest suicide rates. Places like New York, Massachusetts, California, and most of the Northeast have very low suicide rates compared to the rest of the country. These results were definitely not what i had expected and led me to wonder what led to this. The first thought I had was that these places in Central USA don't have many big cities and likely have less to do leading to more mental health issues. However, as I thought more deeply, I realized that one possible factor could be political orientation of these states. Most of these states are classified as "red" states and hence, have less gun control. Because 3 in 5 gun deaths are by suicide (source: efsgv.org), I wanted to explore if there was a link between gun ownership and the suicide rates displayed on the above map.

## Distribution of Gun Ownership

### Methodology

The process of creating this plot was much the same as the plot describing suicide rates across the USA. Like above, the first step was to create a joined dataset that contained the map data, state data, and the gun ownership data from the *gunOwnership* dataset. After converting that into a sf object, I created the plot and displayed it using plotly to continue using the interactivity I created for the first map. therefore, the only difference between this plot and the one before was the data being displayed. In this map, the coloring of the map is based on the percentage of the state population that owns a gun. This statistic gives a bias-free measure of the prevalence of guns in each state while also taking into account the population of the state.

### Analysis

While looking at this map, I expected to see most of the South and central USA to have higher gun ownership rates. However, I was also looking to see if there was any correlation between this map and the above map.
```{r GunMapParts, include=FALSE, fig.width = 8, fig.height = 4, fig.align="center"}
#creating new dataset with all the information in one place
gunDataNew <- gunData %>%
  #capitalization change for join below
  mutate(state = tolower(State)) %>%
  left_join(state_info, by = "state") %>%
  select(id, state, gunOwnership, totalGuns)
#creating the sf object using the previous one and renaming the id to state
#to match gunDataNew
state_map_new <- state_map %>%
  rename(state = id)
#creating the final dataset to use for plot
graphs_map_guns <- state_map_new %>%
  left_join(gunDataNew, by = "state")
#creating plot object with dynamic text
y <- ggplot(graphs_map_guns, aes(fill = gunOwnership, text = paste("State: ", state))) +
  geom_sf(size = .2, colour = "white") +
  scale_fill_viridis(option = "magma", direction = -1) +
  #adding title and legend title
  labs(fill = "Gun Ownership",
       title = "Percentage of Gun Owners by State")
theme_void()
```

```{r finalGunMap, echo= FALSE, fig.width = 8, fig.height = 4, fig.align="center"}
#plotting object
ggplotly(y, dynamicTicks = TRUE)

```

  While looking at the above map, the first thing I noticed was the two highest states for gun ownership were, by far, Montana and Wyoming again. In addition, in accordance with my prediction, most of the central part of the USA as well as the south had the highest gun ownership rates. States typically classified as 'red" states like Texas, Louisiana, Oklahoma, etc, had significantly higher gun ownership rates than those states classified as "blue" such as California and most of the northeast. Although not the exact same, there are some very clear similarities between this map and the map of suicide rates that may show some correlation that will be further discussed in the next section.

## Guns and Suicide in the USA

  While looking at the suicide rate map and the gun ownership map together, there is some clear overlap that seems to suggest a correlation between these two variables. States like Montana and Wyoming both have the highest gun ownership rates as well as the highest suicide rates. On the other side, states like New Jersey and Massachusetts have the lowest gun ownership rates as well as some of the lowest suicide rates.     To explore this potential relationship further, I created a simple scatterplot to examine the relationship between gun ownership and suicide rate. I created this by using both *gunownership* and *statedata* datasets and then utilizing 'ggplot' to graph the relationship. In addition, I used the 'geom_text' feature to add labels to the plot for each state so that I can see which state is which in the plot.
```{r suicideGun, echo = FALSE, fig.width = 8, fig.height = 5, fig.align="center"}
#wrangling
suicideGun <- SuicideStateWithInfo %>%
  #selecting only the 2 important columns for suicide info
  select(state, RATE) %>%
  #renaming column for joining
  rename(id = state) %>%
  #joining with gun data
  left_join(gunDataNew, by = "id") %>%
  #selecting the 3 important variable to graph
  select(id, RATE, gunOwnership) %>%
  #renaming for clarity
  rename(State = id, Rate = RATE)
#plotting the data with guns on x axis and suicide rates on y
ggplot(suicideGun, aes(x = gunOwnership, y = Rate)) +
  #adding in points
  geom_point() +
  #adding in labels for each state
  geom_text(aes(label= State), hjust = 0, vjust = -0.5)+
  #adding informative labels
  labs(x = "Gun Ownership (Percentage)", 
       y = "Suicide Rate (per 100,000)",
       title = "Suicide Rate vs Gun Ownership by US State")
```  
  By looking at the above plot, There is a clear positive relationship between suicide rate and gun ownership. As Gun ownership increases, so too does the suicide rate in that state. The three states that jump out are Wyoming, Alaska, and Montana. This makes sense based on what we saw in the maps (Alaska was not included). In addition, the lowest points on this graph are Massachusetts and New Jersey which are also the ones we singled out during the observation of the maps. Therefore, There is a clear relationship between gun ownership and Suicide Rate and it is very possible that gun ownership may be one of the contributing factors to higher suicide rates in some states.
  Although these relationships can, by no means, be classified as causal the overwhelming similarities displayed in this plot between gun ownership and suicide rate leads me to believe that there is a strong correlation between these variables. In addition, this deep dive into the United States has showed that one of the potential underlying reasons that some states may have higher suicide rates is gun ownership and by extension, political orientation of the state (due to differing gun control policies).
  While this is a significant finding, I am not saying that gun ownership is the only reason behind differing suicide rates. There are many factors that contribute to this. We have seen many possible explanations for these suicide rates from the above sections such as temperature, world events (such as the fall of the Soviet union), and many others. Therefore, further research would be needed to find more possible explanations for suicide rates and other factors that may contribute to it. 
  The identification of Gun Ownership as a potential explanation for higher suicide rates is a significant one because with further research, plots and data like this can be used to initiate institutional change aimed at reducing suicide and mental health issues. This type of research can help policy-makers glean important insights and hence, make policies aimed at the betterment of our society.

## Limitations

Although there were some insights and developments from this project, it is by no means a be all end all. There are some significant limitations in this research.
  Firstly, as we could see on the scatterplot, Alaska seemed to have very high suicide rates as well as gun ownership rates but was not present on the two maps. This would be something that would make these maps far more convincing in presenting the point and in future research should be included in maps of the USA.
  One other limitation was the lack of multiple years of data. All of this analysis was done using 2019 data and conclusions cannot be drawn from it without having more data from many years as well as running proper tests on the models. Future research would do well to have far more data and utilize it to present a larger picture of the suicide epidemic in which more relationships could be unearthed.
  The next shortcoming of this project was the exploration of just one of the possible causes for differing suicide rate. Although the first map showed some states like Montana and Wyoming having the highest suicide rates, the only explanation given in this project was gun ownership although there may be a multitude of other reasons contributing to those rates. A more complete study could be done to explore more factors such as temperature, population, etc.
  Lastly, This was a blog created by an Intro Data Science student. A more experienced Data Scientist would likely have more tools at their disposal to do a more thorough analysis and go through the proper testing techniques. Therefore, although these plots and maps have a lot of meaning and insights can be gleaned from them, more experience would likely create more informative plots that would show even more.

## Conclusion

Suicide has and will continue to be a tragic but prevalent part of our society. However, as humans and citizens of our world, we have an obligation to help minimize suicide numbers. This project has shown how suicide rates differ across the world as well as in the United States. In addition, we have dug deeper into the data with the goal of finding some factors that contribute to suicide such as temperature, gun ownership, sex, and global events. While none of this is definitive proof of any factor being a causal factor for suicide, what we hope this project has shown is that using the world of data around us, it is possible to dive deeper and find relationships that may help us in minimizing mental health crises and making the world a happier place. using this data in a variety of manners, we can show that there exist concrete changes we can make to help our world/country. With the help of data scientists and statisticians along with policy-makers around the world, this type of project (albeit on a much larger scale) can be used to find real links between certain factors and suicide. We hope that this project was as eye-opening to you all as it was to you and we hope this type of research continues to help minimizing suicide rates across the world!
  